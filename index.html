<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>äº’å‹•è¤‡ç¿’å¤§å¯Œç¿</title>

    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#c3d3c2">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="icon" type="image/png" href="./favicon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥å…¨åŸŸè¨­å®š (Firebase, DEFAULT_SFX) æœƒåœ¨ä¸‹æ–¹ module script ä¸­ import -->
    <!-- è¼‰å…¥èªè¨€æª” (æ–°å¢) -->
    <script src="./lang_config.js"></script>

    <style>
        /* --- æ ¸å¿ƒæ¨£å¼ --- */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100dvh;
            overflow: hidden;
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #c3d3c2;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        /* --- ä¸»é¡Œé¸æ“‡å™¨ (å…è¨±æ²å‹•) --- */
        #theme-selector {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* --- éŠæˆ²èˆå° (Game Stage) --- */
        #game-stage-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #game-stage {
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: 0 0;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            will-change: transform;
        }

        #map-bg {
            display: block;
            pointer-events: none;
        }

        /* --- UI è¦†è“‹å±¤ --- */
        #ui-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 50;
        }

        .ui-element {
            pointer-events: auto;
        }

        /* --- å‹•ç•« --- */
        @keyframes float-up {
            0% {
                opacity: 0;
                transform: translate(-50%, 20px) scale(0.8);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, 0) scale(1.2);
            }

            80% {
                opacity: 1;
                transform: translate(-50%, -20px) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50px) scale(0.5);
            }
        }

        .dice-anim {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            animation: float-up 2s ease-out forwards;
            z-index: 100;
            pointer-events: none;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 15px 5px rgba(250, 204, 21, 0.6);
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                box-shadow: 0 0 30px 15px rgba(250, 204, 21, 0.4);
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        .must-hit {
            animation: pulse-glow 2s infinite ease-in-out;
        }

        /* --- éŠæˆ²å…ƒä»¶ --- */
        .game-square {
            position: absolute;
            width: 5.5%;
            padding-bottom: 5.5%;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.55);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            color: #374151;
        }

        .game-square span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
        }

        .game-square.square-success {
            background-color: rgba(16, 185, 129, 0.8) !important;
            border-color: #059669;
            box-shadow: 0 0 15px #10b981;
            color: white !important;
        }

        .game-square.square-failed {
            background-color: rgba(239, 68, 68, 0.8) !important;
            border-color: #dc2626;
            box-shadow: 0 0 15px #ef4444;
            color: white !important;
        }

        .player-piece {
            position: absolute;
            width: 6%;
            padding-bottom: 6%;
            z-index: 30;
            transform: translate(-50%, -50%) translateY(-60px);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.5));
        }

        .player-piece.moving {
            transform: translate(-50%, -50%) scale(1.2) !important;
            z-index: 40;
        }

        .player-piece img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #fff;
        }

        .shadow-avatar {
            position: absolute;
            width: 4%;
            padding-bottom: 4%;
            z-index: 20;
            opacity: 0.7;
            filter: grayscale(30%) drop-shadow(0 2px 3px rgba(0, 0, 0, 0.3));
            transform: translate(-50%, -50%) translateY(20px);
            transition: all 0.5s ease;
        }

        .shadow-avatar img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.8);
            background-color: #ccc;
        }

        /* --- ä»‹é¢å…ƒä»¶ --- */
        .dice-btn {
            transition: transform 0.1s;
        }

        .dice-btn:active {
            transform: scale(0.95);
        }

        .modal-container {
            max-height: 85dvh;
            overflow-y: auto;
        }

        /* --- RWD --- */
        @media (orientation: portrait) {
            #leaderboard-panel {
                top: 16px !important;
                left: 16px !important;
                max-height: 70vh !important;
            }

            #player-info-bar {
                top: 80px !important;
                bottom: auto !important;
                left: auto !important;
                right: 16px !important;
                flex-direction: row-reverse !important;
            }

            #player-info-bar #player-details {
                margin-left: 0 !important;
                margin-right: 0.75rem !important;
                transform-origin: right center !important;
            }
        }
    </style>
  <script type="module" crossorigin src="./assets/main-CiOjWZCK.js"></script>
  <link rel="modulepreload" crossorigin href="./assets/global_config-vaLYm7Na.js">
</head>

<body>

    <!-- PART 1: ä¸»é¡Œé¸æ“‡å™¨ -->
    <div id="theme-selector" class="fixed inset-0 z-[100] bg-gray-100 hidden">
        <div class="min-h-full p-6 md:p-10 flex flex-col items-center justify-center">
            <h1 class="text-3xl md:text-5xl font-extrabold text-gray-800 mb-8 mt-4 text-center tracking-tight"
                data-lang="themeSelectorTitle">ğŸ“š è«‹é¸æ“‡è¤‡ç¿’ä¸»é¡Œ</h1>
            <div id="theme-list" class="flex flex-wrap justify-center gap-8 w-full max-w-7xl pb-10">
                <div class="text-center text-gray-500 animate-pulse text-xl w-full" data-lang="themeLoading">æ­£åœ¨è®€å–ä¸»é¡Œåˆ—è¡¨...
                </div>
            </div>

            <!-- æ–°å¢ï¼šä¸»é¡Œå‰µä½œæŒ‰éˆ• -->
            <div class="mt-8">
                <a href="./tool_theme_creator.html"
                    class="flex items-center gap-2 bg-white px-6 py-3 rounded-2xl shadow-md hover:shadow-lg transition-all text-indigo-600 font-bold border border-indigo-100 hover:scale-105">
                    ğŸ¨ å‰µä½œæ–°ä¸»é¡Œ
                </a>
            </div>
        </div>
    </div>

    <!-- PART 2: éŠæˆ²å¼•æ“ -->
    <div id="game-engine-root" class="hidden">
        <div id="loading-screen" class="fixed inset-0 z-[90] flex flex-col justify-center items-center bg-[#c3d3c2]">
            <img id="loading-img" class="w-32 h-32 mb-4 object-contain" alt="Loading...">
            <h2 class="text-2xl font-bold text-gray-700" data-lang="loadingTitle">è¼‰å…¥ä¸­...</h2>
        </div>
        <div id="game-stage-container">
            <div id="game-stage">
                <img id="map-bg" alt="Game Map" draggable="false">
                <div id="board-squares-layer" class="absolute inset-0"></div>
                <div id="players-layer" class="absolute inset-0"></div>
            </div>
        </div>
        <div id="ui-overlay">
            <button id="settings-btn"
                class="ui-element absolute top-4 right-4 bg-black/30 hover:bg-black/50 text-white p-3 rounded-full backdrop-blur-md transition-all z-50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
            <div id="leaderboard-panel"
                class="ui-element absolute top-4 left-4 flex flex-col items-start z-40 max-h-[85vh] transition-all duration-300">
                <button id="leaderboard-toggle"
                    class="bg-white/90 backdrop-blur-md p-2 rounded-full shadow-lg mb-2 flex items-center justify-center w-12 h-12"><span
                        id="lb-icon" class="text-xl">âœ–ï¸</span></button>
                <div id="leaderboard-content"
                    class="bg-white/90 backdrop-blur-md rounded-2xl shadow-xl overflow-hidden w-64 flex flex-col transition-all origin-top-left flex-1 min-h-0">
                    <div class="flex p-2 bg-gray-100/50 border-b border-gray-200"><button id="tab-live"
                            class="flex-1 py-1 px-2 text-sm font-bold rounded-lg bg-blue-500 text-white mr-1"
                            data-lang="tabLive">å³æ™‚</button><button id="tab-history"
                            class="flex-1 py-1 px-2 text-sm font-bold rounded-lg bg-gray-200 text-gray-600 ml-1"
                            data-lang="tabHistory">æ­·å²</button></div>
                    <ul id="leaderboard-list" class="p-2 overflow-y-auto flex-grow space-y-1 text-sm"></ul>
                </div>
            </div>
            <div id="player-info-bar"
                class="ui-element absolute bottom-4 left-4 flex items-center z-40 transition-all duration-300">
                <div id="player-avatar-btn"
                    class="w-16 h-16 rounded-full border-4 border-white shadow-2xl overflow-hidden cursor-pointer hover:scale-105 transition-transform bg-gray-300">
                </div>
                <div id="player-details"
                    class="ml-3 bg-white/90 backdrop-blur-md p-3 pr-4 rounded-2xl shadow-xl flex items-center transition-all origin-left scale-0 opacity-0 pointer-events-none">
                    <div>
                        <div id="info-name" class="font-bold text-gray-800"></div>
                        <div class="text-sm text-blue-600 font-bold"><span data-lang="scorePrefix">åˆ†æ•¸: </span><span
                                id="info-score">0</span></div>
                    </div>
                    <button id="edit-btn" class="ml-4 p-2 text-gray-400 hover:text-blue-500 pointer-events-auto"
                        title="ç·¨è¼¯">âœï¸</button>
                </div>
            </div>
            <div id="guide-panel" class="ui-element absolute bottom-4 right-4 flex flex-col items-end z-40">
                <div id="guide-bubble"
                    class="bg-white/95 backdrop-blur-md p-4 rounded-2xl rounded-br-none shadow-2xl mb-2 max-w-[250px] text-sm font-bold text-gray-800 hidden transition-all">
                </div>
                <img id="guide-img"
                    class="w-24 h-auto filter drop-shadow-lg cursor-pointer hover:scale-105 transition-transform active:scale-95"
                    alt="Guide">
            </div>
            <div class="ui-element absolute bottom-8 left-1/2 -translate-x-1/2 z-40">
                <button id="dice-btn"
                    class="dice-btn bg-gradient-to-b from-yellow-400 to-orange-500 text-white w-24 h-24 rounded-full border-4 border-white shadow-[0_10px_30px_rgba(245,158,11,0.5)] flex items-center justify-center text-5xl hover:scale-110 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">ğŸ²</button>
            </div>
            <div id="zoom-controls"
                class="ui-element absolute right-4 top-1/2 -translate-y-1/2 flex flex-col gap-2 z-40">
                <button id="zoom-in"
                    class="w-12 h-12 bg-white/80 backdrop-blur text-2xl font-bold rounded-full shadow-lg hover:bg-white active:scale-95">+</button>
                <button id="zoom-out"
                    class="w-12 h-12 bg-white/80 backdrop-blur text-2xl font-bold rounded-full shadow-lg hover:bg-white active:scale-95">-</button>
                <button id="zoom-reset"
                    class="w-12 h-12 bg-white/80 backdrop-blur text-lg rounded-full shadow-lg hover:bg-white active:scale-95">âŸ²</button>
            </div>
        </div>
    </div>

    <!-- PART 3: æ¨¡æ…‹å½ˆçª— -->
    <div id="start-modal"
        class="fixed inset-0 bg-black/60 flex justify-center items-center z-[60] hidden backdrop-blur-sm p-4">
        <div class="bg-white p-6 md:p-8 rounded-[2rem] shadow-2xl w-full max-w-lg modal-container">
            <h2 class="text-3xl font-extrabold text-center text-blue-600 mb-6" data-lang="startTitle">å»ºç«‹ä½ çš„è§’è‰²</h2>
            <div class="mb-6"><label class="block text-sm font-bold text-gray-700 mb-2"
                    data-lang="labelNickname">å†’éšªæš±ç¨±</label>
                <div class="flex"><input type="text" id="nickname-input"
                        class="flex-grow px-4 py-3 border-2 border-gray-200 rounded-l-xl focus:border-blue-500 outline-none text-lg"><button
                        id="reroll-btn"
                        class="bg-gray-100 px-4 text-xl border-2 border-l-0 border-gray-200 rounded-r-xl hover:bg-gray-200">ğŸ”„</button>
                </div>
            </div>
            <div class="mb-8">
                <p class="block text-sm font-bold text-gray-700 mb-3" data-lang="labelAvatar">é¸æ“‡é ­åƒ</p>
                <div id="avatar-grid" class="flex flex-wrap justify-center gap-4"></div>
            </div>
            <div class="flex flex-col gap-3">
                <div class="flex gap-3">
                    <button id="cancel-edit-btn"
                        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-4 rounded-xl hidden"
                        data-lang="btnCancel">å–æ¶ˆ</button>
                    <button id="start-confirm-btn"
                        class="flex-[2] bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-4 rounded-xl shadow-lg"
                        data-lang="btnConfirm">ç¢ºèª</button>
                </div>
                <button id="start-back-btn"
                    class="w-full bg-gray-100 hover:bg-gray-200 text-gray-500 font-bold py-3 rounded-xl flex items-center justify-center gap-2"
                    data-lang="btnBackMenu">ğŸ  å›ä¸»é¸å–®</button>
            </div>
        </div>
    </div>
    <div id="qa-modal"
        class="fixed inset-0 bg-black/60 flex justify-center items-center z-[70] hidden backdrop-blur-sm p-4">
        <div
            class="bg-white p-6 md:p-8 rounded-[2rem] shadow-2xl w-full max-w-2xl modal-container transition-all scale-100">
            <div class="text-center mb-6"><span id="qa-city"
                    class="inline-block bg-blue-100 text-blue-800 px-4 py-1 rounded-full font-bold mb-3"></span>
                <h3 id="qa-text" class="text-2xl font-bold text-gray-800 leading-relaxed"></h3>
            </div>
            <div id="qa-options" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"></div>
            <div id="qa-feedback" class="text-center text-lg font-bold h-8"></div>
            <button id="qa-close-btn"
                class="w-full mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 rounded-xl hidden"
                data-lang="reviewCloseBtn">é—œé–‰è¤‡ç¿’</button>
        </div>
    </div>
    <div id="end-modal"
        class="fixed inset-0 bg-black/80 flex justify-center items-center z-[80] hidden backdrop-blur-md p-4">
        <div class="bg-white p-8 md:p-10 rounded-[2.5rem] shadow-2xl w-full max-w-md text-center modal-container">
            <h2 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-4"
                data-lang="endTitle">ğŸ‰ æ­å–œé€šé—œï¼</h2>
            <p id="end-msg" class="text-lg text-gray-600 mb-8"></p>
            <div class="bg-gray-50 p-6 rounded-2xl mb-8 flex justify-around">
                <div>
                    <div class="text-gray-500 text-sm" data-lang="labelTotal">ç¸½é¡Œæ•¸</div>
                    <div id="end-total" class="font-bold text-2xl">0</div>
                </div>
                <div>
                    <div class="text-gray-500 text-sm" data-lang="labelCorrect">ç­”å°</div>
                    <div id="end-correct" class="font-bold text-2xl text-green-600">0</div>
                </div>
            </div>
            <button id="end-review-btn"
                class="w-full bg-yellow-500 hover:bg-yellow-600 text-white text-xl font-bold py-4 rounded-2xl shadow-lg pulse-glow"
                data-lang="btnReviewMode">ğŸ‘€ é€²å…¥è¤‡ç¿’æ¨¡å¼</button>
        </div>
    </div>
    <div id="settings-modal" class="fixed inset-0 bg-black/50 flex justify-center items-center z-[90] hidden p-4">
        <div class="bg-white p-8 rounded-[2rem] shadow-2xl w-full max-w-sm modal-container">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center" data-lang="settingsTitle">è¨­å®š</h2>
            <div class="space-y-6 mb-8">
                <div>
                    <div class="flex justify-between mb-2"><label class="font-bold" data-lang="labelMusic">ğŸµ
                            éŸ³æ¨‚</label><span id="vol-bgm-val" class="text-sm text-gray-500">50%</span></div><input
                        type="range" id="vol-bgm" min="0" max="1" step="0.1" class="w-full">
                </div>
                <div>
                    <div class="flex justify-between mb-2"><label class="font-bold" data-lang="labelSound">ğŸ”Š
                            éŸ³æ•ˆ</label><span id="vol-sfx-val" class="text-sm text-gray-500">80%</span></div><input
                        type="range" id="vol-sfx" min="0" max="1" step="0.1" class="w-full">
                </div>
            </div>
            <div class="space-y-3 pt-6 border-t border-gray-200">
                <button id="soft-reset-btn"
                    class="w-full bg-yellow-100 hover:bg-yellow-200 text-yellow-800 font-bold py-3 rounded-xl"
                    data-lang="btnSoftReset">ğŸ”„ é‡ç©æœ¬å±€ (ä¿ç•™ç´€éŒ„)</button>
                <button id="hard-reset-btn"
                    class="w-full bg-red-100 hover:bg-red-200 text-red-800 font-bold py-3 rounded-xl"
                    data-lang="btnHardReset">ğŸšª å®Œå…¨ç™»å‡º</button>
                <button id="back-menu-btn"
                    class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-xl flex items-center justify-center"
                    data-lang="btnBackMenu">ğŸ  å›ä¸»é¸å–®</button>
            </div>
            <button id="settings-close-btn"
                class="w-full mt-6 bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 rounded-xl"
                data-lang="btnClose">é—œé–‰</button>
        </div>
    </div>
    <div id="custom-modal" class="fixed inset-0 bg-black/50 flex justify-center items-center z-[100] hidden p-4">
        <div class="bg-white p-6 rounded-3xl shadow-2xl w-full max-w-sm text-center transform scale-95 opacity-0 transition-all"
            id="custom-modal-content">
            <h3 id="custom-modal-title" class="text-xl font-bold text-gray-900 mb-2"></h3>
            <p id="custom-modal-msg" class="text-gray-600 mb-6"></p>
            <div class="flex gap-3" id="custom-modal-actions">
                <button id="custom-modal-cancel"
                    class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 rounded-xl hidden"
                    data-lang="btnCancel">å–æ¶ˆ</button>
                <button id="custom-modal-confirm"
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl"
                    data-lang="btnConfirm">ç¢ºèª</button>
            </div>
        </div>
    </div>
    <div id="nickname-tooltip"
        class="fixed bg-black/80 text-white text-sm px-3 py-1.5 rounded-lg pointer-events-none z-[110] hidden transition-opacity">
    </div>

    <!-- PART 4: æ ¸å¿ƒè…³æœ¬ -->
</body>

</html>